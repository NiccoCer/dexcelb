<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEXCELB Web v4.8</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body class="bg-dark text-light">
    <div class="container-fluid py-4">
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="mb-2"><i class="fas fa-database text-primary"></i> DEXCELB Web v4.8</h1>
                <p class="text-muted mb-0">Gestione DB Excel - Carica, modifica, esporta</p>
            </div>
        </div>

        <!-- Upload DB -->
        <div class="card mb-4 bg-dark border-primary">
            <div class="card-body">
                <h5 class="card-title"><i class="fas fa-file-excel text-success"></i> Carica DB Excel</h5>
                <div class="input-group">
                    <input type="file" class="form-control bg-secondary text-light" id="dbFile" accept=".xlsx,.xlsm">
                    <button class="btn btn-success" onclick="loadDB()" id="loadBtn" disabled>
                        <i class="fas fa-upload"></i> Carica DB
                    </button>
                </div>
                <div id="dbStatus" class="mt-2 text-muted small"></div>
            </div>
        </div>

        <!-- Dashboard Cards -->
        <div class="row mb-4" id="dashboardCards">
            <div class="col-md-3 mb-3">
                <div class="card bg-dark border-warning h-100 action-card" onclick="showTable()">
                    <div class="card-body text-center">
                        <i class="fas fa-table fa-2x text-warning mb-2"></i>
                        <h6 class="card-title mb-1">ðŸ“Š Tabella Clienti</h6>
                        <p class="card-text small text-muted">Visualizza, filtra, modifica</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card bg-dark border-info h-100 action-card" onclick="downloadDB()">
                    <div class="card-body text-center">
                        <i class="fas fa-download fa-2x text-info mb-2"></i>
                        <h6 class="card-title mb-1">ðŸ’¾ Scarica DB</h6>
                        <p class="card-text small text-muted">Esporta Excel modificato</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabella Principale -->
        <div class="card bg-dark border-secondary" id="tableContainer" style="display:none;">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-table"></i> Gestisci Clienti</h5>
                <div>
                    <input type="text" id="filterInput" class="form-control form-control-sm d-inline-block w-auto me-2" placeholder="Filtra...">
                    <button class="btn btn-sm btn-success me-1" onclick="markSelected('convertita')"><i class="fas fa-check"></i> Convertita</button>
                    <button class="btn btn-sm btn-warning me-1" onclick="markSelected('non_conv')"><i class="fas fa-clock"></i> Non Conv</button>
                    <button class="btn btn-sm btn-info me-1" onclick="copySelected()"><i class="fas fa-copy"></i> Copia</button>
                    <button class="btn btn-sm btn-secondary" onclick="clearFilters()"><i class="fas fa-eye"></i> Tutto</button>
                </div>
            </div>
            <div class="card-body p-0">
                <table id="dataTable" class="table table-dark table-striped mb-0">
                    <thead></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Toast per feedback -->
        <div class="toast-container position-fixed bottom-0 end-0 p-3">
            <div id="liveToast" class="toast" role="alert">
                <div class="toast-header bg-success text-white">
                    <i class="fas fa-check-circle me-2"></i>
                    <strong class="me-auto">Successo</strong>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
                </div>
                <div class="toast-body"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    <script src="/static/dexcelb.js"></script>
</body>
</html>
